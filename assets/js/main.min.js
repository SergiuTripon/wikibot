var wikipedia_extract_endpoint="https://en.wikipedia.org/w/api.php?origin=*&action=query&format=json&prop=extracts&explaintext&redirects&titles=",cape_ai_admin_token="BJONJ_gfjkakPucSl8j5qjIVK6mAhUbpzS23GgbvY0s",cape_ai_add_document_endpoint="https://responder.thecape.ai/api/0.1/documents/add-document?adminToken="+cape_ai_admin_token+"&replace=true",cape_ai_answer_endpoint="https://responder.thecape.ai/api/0.1/answer?adminToken="+cape_ai_admin_token,cape_ai_create_saved_reply_endpoint="https://responder.thecape.ai/api/0.1/saved-replies/add-saved-reply?adminToken="+cape_ai_admin_token,form_error=!1,submit=$("#submit"),subject=$("#subject"),question=$("#question"),question_answer=$("#question-answer"),loading=$("#loading");loading.hide();var questions_n_answers={},question_n_answer_no=1;function get_current_date_time(){return moment().format("ddd D MMM | h:mma")}function create_saved_reply(e){var t=questions_n_answers[e][0],n=questions_n_answers[e][1];$.ajax({type:"POST",url:cape_ai_create_saved_reply_endpoint,data:{question:t,answer:n}}).then(function(t){500!==t&&$("#"+e).replaceWith("<p class='card-text mb-0'><small class='text-success'>Thank you!</small></p>")}).catch(function(t){500===t.status&&$("#"+e).replaceWith("<p class='card-text mb-0'><small class='text-info'>Already a good answer!</small></p>")})}function answer_question(e,t){var n="";return n+=t.result.documentId,$.ajax({type:"POST",url:cape_ai_answer_endpoint,data:{question:e,documentIds:n}}).then(function(e){return e}).catch(function(e){return e.status})}function upload_document(e,t){return $.ajax({type:"POST",url:cape_ai_add_document_endpoint,data:{title:e,text:t}}).then(function(e){return e}).catch(function(e){return e.status})}function get_extract(e){return $.ajax({url:wikipedia_extract_endpoint+encodeURIComponent(e)}).then(function(e){return e}).catch(function(e){return e.status})}submit.click(function(e){e.preventDefault();var t=subject.val();if(""===t)return subject.focus(),subject.tooltip("dispose"),question.tooltip("dispose"),subject.tooltip({html:!0,trigger:"manual",placement:"bottom",template:"<div class='tooltip' role='tooltip'><div class='arrow border-danger'></div><div class='tooltip-inner bg-danger'></div></div>",title:"<span>No subject, no question!</span>"}).tooltip("show"),form_error=!0,!1;subject.tooltip("dispose"),form_error=!1;var n=question.val();return""===n?(question.focus(),subject.tooltip("dispose"),question.tooltip("dispose"),question.tooltip({html:!0,trigger:"manual",placement:"bottom",template:"<div class='tooltip' role='tooltip'><div class='arrow border-danger'></div><div class='tooltip-inner bg-danger'></div></div>",title:"<span>No question, no answer!</span>"}).tooltip("show"),form_error=!0,!1):(question.tooltip("dispose"),!1===(form_error=!1)&&$.when(get_extract(t)).then(function(e){var t=Object.values(e.query.pages)[0];t.extract?(question.val(""),$(".card-body").find("#loading").before("<div id='question-block' class='d-flex align-items-center justify-content-center mt-3'><div id='question-icon' class='mr-3'><i class='fas fa-user-circle fa-2x text-warning'></i></div><div id='question-text' class='card card-body p-2 rounded-0'><p class='mb-0'><b>"+n+"</b></p><hr class='mt-2 mb-2'><div class='d-flex justify-content-between'><p class='card-text mb-0'><small class='text-muted'>"+get_current_date_time()+"</small></p></div></div></div>"),loading.show(),question_answer.animate({scrollTop:question_answer.prop("scrollHeight")},1e3),$.when(upload_document(t.pageid+" - "+t.title,t.extract)).then(function(e){$.when(answer_question(n,e)).then(function(e){loading.hide();var t=e.result.items[0];questions_n_answers[question_n_answer_no]=[n,t.answerText],$(".card-body").find("#loading").before("<div id='answer-block' class='d-flex align-items-center justify-content-center mt-3'><div id='answer-text' class='card card-body p-2 rounded-0'><p class='mb-0'><b>"+t.answerText+"</b>"+(t.answerContext?" ("+t.answerContext+")":"")+"</p><hr class='mt-2 mb-2'><div class='d-flex justify-content-between'><p class='card-text mb-0'><small class='text-muted'>"+get_current_date_time()+"</small></p><a id='"+question_n_answer_no+"' href='#' class='good-answer card-link' tabindex='-1' onclick='event.preventDefault(); create_saved_reply("+question_n_answer_no+")'><small>Good answer!</small></a></div></div><div id='answer-icon' class='ml-3'><i class='fas fa-user-circle text-success'></i></div></div>"),question_n_answer_no++,question_answer.animate({scrollTop:question_answer.prop("scrollHeight")},1e3)})})):subject.tooltip({html:!0,trigger:"manual",placement:"bottom",template:"<div class='tooltip' role='tooltip'><div class='arrow border-danger'></div><div class='tooltip-inner bg-danger'></div></div>",title:"<span>No Wikipedia article for this subject, I'm afraid...</span>"}).tooltip("show")}),!0)});